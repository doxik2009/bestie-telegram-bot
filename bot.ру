import os
import random
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import (
    Application, CommandHandler, CallbackQueryHandler,
    MessageHandler, filters, ContextTypes
)

# =======================
# –í–û–ü–†–û–°–´
# =======================

QUESTIONS_BESTIA = [
    "–¢—ã –ø–∏—à–µ—à—å ¬´–æ–∫¬ª ‚Äî —ç—Ç–æ‚Ä¶",
    "–ï—Å–ª–∏ —è –æ–ø–∞–∑–¥—ã–≤–∞—é –Ω–∞ 20 –º–∏–Ω—É—Ç, —Ç—ã‚Ä¶",
    "–í –ø–ª–æ—Ö–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏ –º–Ω–µ –ª—É—á—à–µ –ø—Ä–∏—Å–ª–∞—Ç—å‚Ä¶",
    "–ú—ã –º–æ–∂–µ–º –Ω–µ –æ–±—â–∞—Ç—å—Å—è –º–µ—Å—è—Ü –∏ –Ω–µ –æ–±–∏–∂–∞—Ç—å—Å—è?",
    "–ï—Å–ª–∏ –º—ã –ø–æ—Å—Å–æ—Ä–∏–ª–∏—Å—å ‚Äî –∫—Ç–æ –ø–µ—Ä–≤—ã–π –ø—Ä–∏—à–ª—ë—Ç –º–µ–º?",
    "–ö—Ç–æ –∏–∑ –Ω–∞—Å —á–∞—â–µ –≤—Ä—ë—Ç ¬´—è —É–∂–µ –≤—ã—Ö–æ–∂—É¬ª?",
    "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –≤—Ç—è–Ω–µ—Ç—Å—è –≤ –∞–≤–∞–Ω—Ç—é—Ä—É?",
    "–ö—Ç–æ –≥—Ä–æ–º—á–µ —Å–º–µ—ë—Ç—Å—è?",
    "–ö—Ç–æ —á–∞—â–µ –∑–∞–±—ã–≤–∞–µ—Ç, –∑–∞—á–µ–º –ø—Ä–∏—à—ë–ª?",
    "–ö—Ç–æ –ø–µ—Ä–≤—ã–º –ø—Ä–µ–¥–ª–æ–∂–∏—Ç –µ—â—ë –ø–æ –±–æ–∫–∞–ª—É?",
    "–ö—Ç–æ —É–º–µ–µ—Ç –¥–µ–ª–∞—Ç—å –ª–∏—Ü–æ ¬´—è –≤—Å—ë –ø–æ–Ω—è–ª–∞¬ª, –Ω–µ –ø–æ–Ω–∏–º–∞—è –Ω–∏—á–µ–≥–æ?",
    "–ö—Ç–æ –º–æ–∂–µ—Ç –∏—Å—á–µ–∑–Ω—É—Ç—å –∏ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫–∞–∫ –Ω–∏ –≤ —á—ë–º –Ω–µ –±—ã–≤–∞–ª–æ?",
    "–ö—Ç–æ —á–∞—â–µ –≥–æ–≤–æ—Ä–∏—Ç ¬´—è –Ω–µ —Ç–∞–∫–∞—è¬ª, –Ω–æ —Ç–∞–∫–∞—è?",
    "–ö—Ç–æ —Ç–æ—á–Ω–æ –Ω–∞–ø–∏—à–µ—Ç –±—ã–≤—à–µ–º—É —Å–ª—É—á–∞–π–Ω–æ?",
    "–ö—Ç–æ —Å–∞–º–∞—è –æ–ø–∞—Å–Ω–∞—è, –∫–æ–≥–¥–∞ —Ç—Ä–µ–∑–≤–∞—è?",
    "–ö—Ç–æ —á–∞—â–µ –≤—Å–µ–≥–æ –≥–æ–≤–æ—Ä–∏—Ç: ¬´–≠—Ç–æ –ø–ª–æ—Ö–∞—è –∏–¥–µ—è‚Ä¶ –Ω–æ –¥–∞–≤–∞–π¬ª?",
    "–ö—Ç–æ –±—ã—Å—Ç—Ä–æ –∑–∞–≤–æ–¥–∏—Ç –Ω–æ–≤—ã—Ö –ø–æ–¥—Ä—É–≥?",
    "–ö—Ç–æ –±–æ–ª—å—à–µ –≤—Å–µ—Ö –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–æ–º–ø–∞–Ω–∏—é?",
    "–ö—Ç–æ —á–∞—â–µ –¥–µ–ª–∞–µ—Ç –≤–∏–¥, —á—Ç–æ –≤—Å—ë –ø–æ–¥ –∫–æ–Ω—Ç—Ä–æ–ª–µ–º?",
    "–ö—Ç–æ —Ç–æ—á–Ω–æ –≤—ã–∂–∏–≤–µ—Ç –≤ –ª—é–±–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏?",
    "–ö—Ç–æ –º–æ–∂–µ—Ç –Ω–∞—á–∞—Ç—å —Ç–∞–Ω—Ü–µ–≤–∞—Ç—å –±–µ–∑ –º—É–∑—ã–∫–∏?",
    "–ö—Ç–æ –ø–µ—Ä–≤–∞—è –ø–æ–ª–µ–∑–µ—Ç —Ä–∞–∑–Ω–∏–º–∞—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç?",
    "–ö—Ç–æ —á–∞—â–µ –≤—Å–µ—Ö —Ç–µ—Ä—è–µ—Ç –≤–µ—â–∏?",
    "–ö—Ç–æ –º–æ–∂–µ—Ç —Å–º–µ—è—Ç—å—Å—è –≤ —Å–∞–º—ã–π –Ω–µ–ø–æ–¥—Ö–æ–¥—è—â–∏–π –º–æ–º–µ–Ω—Ç?",
    "–ö—Ç–æ —á–∞—â–µ –≥–æ–≤–æ—Ä–∏—Ç –ø—Ä–∞–≤–¥—É –≤ –ª–æ–±?",
    "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –≤—Å–µ—Ö —É—Å—Ç–∞–µ—Ç, –Ω–æ –Ω–µ –ø—Ä–∏–∑–Ω–∞—ë—Ç—Å—è?",
    "–ö—Ç–æ –º–æ–∂–µ—Ç –≤–ª—é–±–∏—Ç—å—Å—è –∑–∞ –≤–µ—á–µ—Ä?",
    "–ö—Ç–æ –≤—Å–µ–≥–¥–∞ –∑–Ω–∞–µ—Ç, –≥–¥–µ –≤–∫—É—Å–Ω–æ?",
    "–ö—Ç–æ —á–∞—â–µ –≤—Å–µ–≥–æ –æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∞–≤?",
    "–ö—Ç–æ —É–º–µ–µ—Ç –¥–µ–ª–∞—Ç—å –¥—Ä–∞–º—É –∏–∑ –Ω–∏—á–µ–≥–æ?",
    "–ö—Ç–æ —Å–∞–º–∞—è –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω–∞—è?",
    "–ö—Ç–æ –º–æ–∂–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å –¥–∞–∂–µ —à—É—Ç–∫–æ–π?",
    "–ö—Ç–æ —Å–∞–º–∞—è –Ω–µ–ø—Ä–µ–¥—Å–∫–∞–∑—É–µ–º–∞—è?",
    "–ö—Ç–æ –≤—Å–µ–≥–¥–∞ ¬´–¥–∞–≤–∞–π –ø–æ—Å–º–æ—Ç—Ä–∏–º¬ª?",
    "–ö—Ç–æ –º–æ–∂–µ—Ç –≤—Å—ë –±—Ä–æ—Å–∏—Ç—å —Ä–∞–¥–∏ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è?",
    "–ö—Ç–æ —á–∞—â–µ –≤—Å–µ—Ö —Å–º–µ—ë—Ç—Å—è –Ω–∞–¥ —Å–æ–±–æ–π?",
    "–ö—Ç–æ –º–æ–∂–µ—Ç —Ö—Ä–∞–Ω–∏—Ç—å —Å–µ–∫—Ä–µ—Ç—ã?",
    "–ö—Ç–æ —á–∞—â–µ –≤—Å–µ—Ö –ø—Ä–∏—Ç–≤–æ—Ä—è–µ—Ç—Å—è —Å–ø–æ–∫–æ–π–Ω–æ–π?",
    "–ö—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –æ–ø–∞—Å–Ω–∞—è, –Ω–æ –º–∏–ª–∞—è?",
    "–ö—Ç–æ —Ç–∞ —Å–∞–º–∞—è –±–µ—Å—Ç–∏—è?"
]

QUESTIONS_COFFEE = [
    "–ö–∞–∫–æ–µ –ø–µ—Ä–≤–æ–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ —Ç—ã –æ–±—ã—á–Ω–æ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—à—å?",
    "–ß—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç —Ç–µ–±–µ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–µ–±—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ –≤ –Ω–æ–≤–æ–π –∫–æ–º–ø–∞–Ω–∏–∏?",
    "–û —á—ë–º —Ç–µ–±–µ –ø—Ä–æ—â–µ –≤—Å–µ–≥–æ –∑–∞–≥–æ–≤–æ—Ä–∏—Ç—å —Å –Ω–µ–∑–Ω–∞–∫–æ–º—ã–º–∏?",
    "–ß—Ç–æ —Ç–µ–±—è —Å—Ä–∞–∑—É —Ä–∞—Å–ø–æ–ª–∞–≥–∞–µ—Ç –∫ —á–µ–ª–æ–≤–µ–∫—É?",
    "–ß—Ç–æ –º–æ–∂–µ—Ç –Ω–∞–ø—Ä—è—á—å –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–Ω–∞–∫–æ–º—Å—Ç–≤–µ?",
    "–¢—ã –±–æ–ª—å—à–µ —Å–ª—É—à–∞–µ—à—å –∏–ª–∏ –≥–æ–≤–æ—Ä–∏—à—å?",
    "–ö–∞–∫ —Ç—ã —Ä–µ–∞–≥–∏—Ä—É–µ—à—å –Ω–∞ –Ω–µ–ª–æ–≤–∫–∏–µ –ø–∞—É–∑—ã?",
    "–ß—Ç–æ —Ç–µ–±—è —Ç–æ—á–Ω–æ —Ä–∞—Å—Å–º–µ—à–∏—Ç?",
    "–ö–∞–∫ –ø–æ–Ω—è—Ç—å, —á—Ç–æ —Å —á–µ–ª–æ–≤–µ–∫–æ–º ¬´–Ω–æ—Ä–º¬ª?",
    "–¢—ã –ª—é–±–∏—à—å –ª—ë–≥–∫–∏–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã –∏–ª–∏ –ø–æ–≥–ª—É–±–∂–µ?",
    "–ß—Ç–æ —á–∞—â–µ –≤—Å–µ–≥–æ —Å–ø—Ä–∞—à–∏–≤–∞—é—Ç —É —Ç–µ–±—è –ø—Ä–∏ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–µ?",
    "–ö–∞–∫–æ–π –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç —Ç–µ–±–µ –ø—Ä–∏—è—Ç–Ω–µ–µ –≤—Å–µ–≥–æ?",
    "–ß—Ç–æ —Ç—ã —Ü–µ–Ω–∏—à—å –≤ –Ω–æ–≤—ã—Ö –ª—é–¥—è—Ö?",
    "–ß—Ç–æ –º–æ–∂–µ—Ç –æ—Ç—Ç–æ–ª–∫–Ω—É—Ç—å —Å—Ä–∞–∑—É?",
    "–¢—ã –ª–µ–≥–∫–æ –¥–æ–≤–µ—Ä—è–µ—à—å?",
    "–ö–∞–∫ —Ç—ã –≤–µ–¥—ë—à—å —Å–µ–±—è –≤ –Ω–æ–≤–æ–π –∫–æ–º–ø–∞–Ω–∏–∏?",
    "–ß—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç —Å–±–ª–∏–∑–∏—Ç—å—Å—è –±—ã—Å—Ç—Ä–µ–µ?",
    "–¢—ã –±–æ–ª—å—à–µ –ø—Ä–æ —é–º–æ—Ä –∏–ª–∏ –ø—Ä–æ –∏—Å–∫—Ä–µ–Ω–Ω–æ—Å—Ç—å?",
    "–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä –∂–∏–≤—ã–º?",
    "–ö–∞–∫ —Ç—ã —Ä–µ–∞–≥–∏—Ä—É–µ—à—å –Ω–∞ —Å—Ç—Ä–∞–Ω–Ω—ã—Ö –ª—é–¥–µ–π?",
    "–ß—Ç–æ –¥–ª—è —Ç–µ–±—è –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–µ –æ–±—â–µ–Ω–∏–µ?",
    "–¢—ã –ª—é–±–∏—à—å, –∫–æ–≥–¥–∞ –º–Ω–æ–≥–æ –ª—é–¥–µ–π –∏–ª–∏ –∫–∞–º–µ—Ä–Ω–æ?",
    "–ß—Ç–æ —Ç–µ–±—è —Ä–∞—Å—Å–ª–∞–±–ª—è–µ—Ç?",
    "–ö–∞–∫ —Ç—ã –æ–±—ã—á–Ω–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—à—å —Ä–∞–∑–≥–æ–≤–æ—Ä?",
    "–¢—ã –ª–µ–≥–∫–æ —Å–º–µ—ë—à—å—Å—è?",
    "–ß—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å ¬´—Å–≤–æ–∏—Ö¬ª?",
    "–ö–∞–∫ —Ç—ã —Ä–µ–∞–≥–∏—Ä—É–µ—à—å –Ω–∞ —Ä–∞–∑–Ω—ã–µ –º–Ω–µ–Ω–∏—è?",
    "–ß—Ç–æ –¥–ª—è —Ç–µ–±—è —Ö–æ—Ä–æ—à–∏–π –≤–µ—á–µ—Ä?",
    "–¢—ã –±–æ–ª—å—à–µ –Ω–∞–±–ª—é–¥–∞—Ç–µ–ª—å –∏–ª–∏ —É—á–∞—Å—Ç–Ω–∏–∫?",
    "–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∑–Ω–∞–∫–æ–º—Å—Ç–≤–æ —É–¥–∞—á–Ω—ã–º?",
    "–¢—ã –ª—é–±–∏—à—å —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç—å?",
    "–ö–∞–∫ –ø–æ–Ω—è—Ç—å, —á—Ç–æ –≤–µ—á–µ—Ä —É–¥–∞–ª—Å—è?",
    "–ß—Ç–æ —Ç—ã –∑–∞–ø–æ–º–∏–Ω–∞–µ—à—å –æ –ª—é–¥—è—Ö?",
    "–ö–∞–∫ —Ç—ã –≤–µ–¥—ë—à—å —Å–µ–±—è, –µ—Å–ª–∏ –≤–æ–ª–Ω—É–µ—à—å—Å—è?",
    "–ß—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç –±—ã—Ç—å —Å–æ–±–æ–π?",
    "–¢—ã –ª—é–±–∏—à—å –≥–ª—É–±–æ–∫–∏–µ —Ç–µ–º—ã?",
    "–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–º–ø–∞–Ω–∏—é —Ç—ë–ø–ª–æ–π?",
    "–¢—ã –ª–µ–≥–∫–æ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—à—å—Å—è?",
    "–ß—Ç–æ –¥–ª—è —Ç–µ–±—è –¥—Ä—É–∂–±–∞?",
    "–ß—Ç–æ –¥–µ–ª–∞–µ—Ç –ª—é–¥–µ–π –±–ª–∏–∂–µ?"
]

FUN_COMMENTS = [
    "üòÇ –û—Ç–ª–∏—á–Ω–æ –ø–æ—à–ª–æ!",
    "üòè –í–æ—Ç —ç—Ç–æ –æ—Ç–≤–µ—Ç—ã!",
    "ü§£ –ß—É–≤—Å—Ç–≤—É—é, –¥–∞–ª—å—à–µ –±—É–¥–µ—Ç –∂–∞—Ä—á–µ",
    "üòé –ê—Ç–º–æ—Å—Ñ–µ—Ä–∞ —É–∂–µ —Ç–∞ —Å–∞–º–∞—è",
    "ü§≠ –ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è, –ø—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ",
    "üî• –ù—É –≤—ã –¥–∞—ë—Ç–µ!",
    "ü•Ç –≠—Ç–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ"
]

# =======================
# –°–û–°–¢–û–Ø–ù–ò–ï
# =======================

GAMES = {}

class GameState:
    def __init__(self, mode):
        self.mode = mode
        self.index = 0

# =======================
# –ö–ù–û–ü–ö–ò
# =======================

def mode_keyboard():
    return InlineKeyboardMarkup([
        [InlineKeyboardButton("üç∑ –ú–æ—è –ë–µ—Å—Ç–∏—è", callback_data="bestia")],
        [InlineKeyboardButton("‚òï –ú–µ–∂–¥—É –Ω–∞–º–∏, –¥–µ–≤–æ—á–∫–∞–º–∏", callback_data="coffee")]
    ])

def ready_keyboard():
    return InlineKeyboardMarkup([
        [InlineKeyboardButton("‚úÖ –ì–û–¢–û–í–û", callback_data="ready")]
    ])

# =======================
# –•–≠–ù–î–õ–ï–†–´
# =======================

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        "üíñ –ò–≥—Ä–∞ –¥–ª—è –¥–µ–≤–æ—á–µ–∫\n\n"
        "/newgame ‚Äî –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É\n\n"
        "–ú–æ–∂–Ω–æ –∏–≥—Ä–∞—Ç—å –æ–Ω–ª–∞–π–Ω –∏ –æ—Ñ–ª–∞–π–Ω.\n"
        "–û—Ç–≤–µ—á–∞–π—Ç–µ –∫–∞–∫ —Ö–æ—Ç–∏—Ç–µ ‚Äî –≤—Å–ª—É—Ö –∏–ª–∏ –≤ —á–∞—Ç–µ."
    )

async def newgame(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text(
        "–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º:",
        reply_markup=mode_keyboard()
    )

async def choose_mode(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    chat_id = query.message.chat.id
    mode = query.data

    GAMES[chat_id] = GameState(mode)

    await query.edit_message_text(
        "–ú–æ–∂–Ω–æ –≤–≤–µ—Å—Ç–∏ –∏–º–µ–Ω–∞ —É—á–∞—Å—Ç–Ω–∏—Ü —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é\n"
        "–∏–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–∞–∂–∞—Ç—å –ì–û–¢–û–í–û",
        reply_markup=ready_keyboard()
    )

async def ready(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    chat_id = query.message.chat.id
    await send_question(chat_id, context)

async def send_question(chat_id, context):
    game = GAMES.get(chat_id)
    if not game:
        return

    questions = QUESTIONS_BESTIA if game.mode == "bestia" else QUESTIONS_COFFEE

    if game.index >= len(questions):
        await context.bot.send_message(chat_id, "üéâ –ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞. –ë—ã–ª–æ –∫–ª–∞—Å—Å–Ω–æ!")
        GAMES.pop(chat_id)
        return

    question = questions[game.index]
    game.index += 1

    await context.bot.send_message(
        chat_id,
        f"‚ùì {question}\n\n"
        "–û—Ç–≤–µ—á–∞–π—Ç–µ –∫–∞–∫ —Ö–æ—Ç–∏—Ç–µ üëá"
    )

async def any_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chat_id = update.effective_chat.id
    if chat_id not in GAMES:
        return

    await context.bot.send_message(
        chat_id,
        random.choice(FUN_COMMENTS)
    )

    await send_question(chat_id, context)

# =======================
# –ó–ê–ü–£–°–ö
# =======================

def main():
    token = os.getenv("BOT_TOKEN")
    if not token:
        raise RuntimeError("BOT_TOKEN not set")

    app = Application.builder().token(token).build()

    app.add_handler(CommandHandler("start", start))
    app.add_handler(CommandHandler("newgame", newgame))
    app.add_handler(CallbackQueryHandler(choose_mode))
    app.add_handler(CallbackQueryHandler(ready, pattern="ready"))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, any_message))

    app.run_polling()

if __name__ == "__main__":
    main()
