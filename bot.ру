import os
import random
from telegram import Update, InlineKeyboardButton, InlineKeyboardMarkup
from telegram.ext import (
    Application, CommandHandler, CallbackQueryHandler,
    MessageHandler, filters, ContextTypes
)

# =======================
# –í–û–ü–†–û–°–´ ‚Äî –ú–û–Ø –ë–ï–°–¢–ò–Ø
# =======================

QUESTIONS_BESTIA = [
    "–¢—ã –ø–∏—à–µ—à—å ¬´–æ–∫¬ª ‚Äî —ç—Ç–æ‚Ä¶",
    "–ï—Å–ª–∏ —è –æ–ø–∞–∑–¥—ã–≤–∞—é –Ω–∞ 20 –º–∏–Ω—É—Ç, —Ç—ã‚Ä¶",
    "–í –ø–ª–æ—Ö–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏ –º–Ω–µ –ª—É—á—à–µ –ø—Ä–∏—Å–ª–∞—Ç—å‚Ä¶",
    "–ú—ã –º–æ–∂–µ–º –Ω–µ –æ–±—â–∞—Ç—å—Å—è –º–µ—Å—è—Ü –∏ –Ω–µ –æ–±–∏–∂–∞—Ç—å—Å—è?",
    "–ï—Å–ª–∏ –º—ã –ø–æ—Å—Å–æ—Ä–∏–ª–∏—Å—å ‚Äî –∫—Ç–æ –ø–µ—Ä–≤—ã–π –ø—Ä–∏—à–ª—ë—Ç –º–µ–º?",
    "–ö–∞–∫—É—é —Å–∞–º—É—é —Å—Ç—Ä–∞–Ω–Ω—É—é –ø—Ä–∏–≤—ã—á–∫—É —É –º–µ–Ω—è –∑–Ω–∞–µ—à—å?",
    "–ï—Å–ª–∏ –º—ã –∏–¥—ë–º –Ω–∞ –≤–µ—á–µ—Ä–∏–Ω–∫—É –≤–º–µ—Å—Ç–µ, –∫—Ç–æ –ø–æ—Ç–µ—Ä—è–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º?",
    "–ö—Ç–æ –∏–∑ –Ω–∞—Å –±–æ–ª—å—à–µ –ª—é–±–∏—Ç –∫–æ—Ñ–µ?",
    "–ï—Å–ª–∏ –≤–¥—Ä—É–≥ –Ω–∞—á–Ω—ë—Ç—Å—è —Ç–∞–Ω—Ü–µ–≤–∞–ª—å–Ω—ã–π –±–∞—Ç—Ç–ª, –∫—Ç–æ –≤—ã–∏–≥—Ä–∞–µ—Ç?",
    "–ö—Ç–æ —á–∞—â–µ –∑–∞–±—ã–≤–∞–µ—Ç –∫–ª—é—á–∏?",
    "–° –∫–µ–º –ª–µ–≥—á–µ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å–µ–∫—Ä–µ—Ç–æ–º?",
    "–ö—Ç–æ –≥—Ä–æ–º—á–µ —Å–º–µ—ë—Ç—Å—è?",
    "–ï—Å–ª–∏ –±—ã –º—ã —Å—Ç–∞–ª–∏ —Å—É–ø–µ—Ä–≥–µ—Ä–æ—è–º–∏, –∫—Ç–æ –±—ã –±—ã–ª —Å–∞–º—ã–º –æ–ø–∞—Å–Ω—ã–º?",
    "–ö—Ç–æ —á–∞—â–µ –Ω–∞—á–∏–Ω–∞–µ—Ç —Å–ø–æ—Ä—ã?",
    "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –µ—Å—Ç —Å–ª–∞–¥–∫–æ–µ?",
    "–ö—Ç–æ –ª—É—á—à–µ –≥–æ—Ç–æ–≤–∏—Ç –º–µ–º—ã?",
    "–ï—Å–ª–∏ —è –ø–ª–∞—á—É –Ω–∞–¥ —Å–µ—Ä–∏–∞–ª–æ–º, –∫—Ç–æ –º–µ–Ω—è –ø–æ–π–º—ë—Ç?",
    "–ö—Ç–æ —á–∞—â–µ —Å—Ç–∞–≤–∏—Ç –ª–∞–π–∫–∏ –Ω–∞ —Å—Ç–æ—Ä–∏—Å?",
    "–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –∫—Ç–æ –±—ã—Å—Ç—Ä–µ–µ —Å–¥–∞—ë—Ç—Å—è?",
    "–ö—Ç–æ –∏–∑ –Ω–∞—Å –±–æ–ª—å—à–µ –ª—é–±–∏—Ç –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è?",
    "–ö—Ç–æ –ª—É—á—à–µ —Ö—Ä–∞–Ω–∏—Ç —Å–µ–∫—Ä–µ—Ç—ã?",
    "–ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ —Å–∫—É—á–∞–µ—Ç, –∫—Ç–æ –ø–µ—Ä–≤—ã–º –Ω–∞–ø–∏—à–µ—Ç?",
    "–ö—Ç–æ —á–∞—â–µ –¥–µ–ª–∞–µ—Ç —Å–º–µ—à–Ω—ã–µ —Å–µ–ª—Ñ–∏?",
    "–ö—Ç–æ —á–∞—â–µ —Å–ø–æ—Ä–∏—Ç –æ —Ñ–∏–ª—å–º–∞—Ö?",
    "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è?",
    "–ö—Ç–æ —á–∞—â–µ –±–µ—Ä—ë—Ç –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É?",
    "–ï—Å–ª–∏ —è –≥—Ä—É—â—É, –∫—Ç–æ –º–µ–Ω—è —Ä–∞–∑–≤–µ—Å–µ–ª–∏—Ç?",
    "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –Ω–∞—á–∏–Ω–∞–µ—Ç —à—É—Ç–∏—Ç—å?",
    "–ï—Å–ª–∏ –∏–¥—ë–º –≤ –º–∞–≥–∞–∑–∏–Ω, –∫—Ç–æ –±–æ–ª—å—à–µ –ø–æ–∫—É–ø–∞–µ—Ç?",
    "–ö—Ç–æ —á–∞—â–µ –æ—Ä–≥–∞–Ω–∏–∑—É–µ—Ç –≤—Å—Ç—Ä–µ—á–∏?",
    "–ö—Ç–æ —á–∞—â–µ –æ–ø–∞–∑–¥—ã–≤–∞–µ—Ç?",
    "–ö—Ç–æ —Å–º–µ—à–Ω–µ–µ —à—É—Ç–∏—Ç?",
    "–ö—Ç–æ –ª—É—á—à–µ –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –∏–º–µ–Ω–∞?",
    "–ö—Ç–æ —á–∞—â–µ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∏–¥–µ–∏?",
    "–ö—Ç–æ —Å–∏–ª—å–Ω–µ–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –∫–æ–º–ø–∞–Ω–∏—é?",
    "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –Ω–∞—Ö–æ–¥–∏—Ç –º–µ–º—ã?",
    "–ö—Ç–æ —á–∞—â–µ –¥–µ–ª–∞–µ—Ç –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç—ã?",
    "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –æ—Å–≤–∞–∏–≤–∞–µ—Ç –Ω–æ–≤–æ–µ?",
    "–ö—Ç–æ —á–∞—â–µ —à—É—Ç–∏—Ç –ø—Ä–æ –µ–¥—É?",
    "–ö—Ç–æ –≥—Ä–æ–º—á–µ —Å–º–µ—ë—Ç—Å—è –Ω–∞–¥ –º–µ–º–∞–º–∏?",
    "–ö—Ç–æ —á–∞—â–µ —Ç–µ—Ä—è–µ—Ç –≤–µ—â–∏?",
    "–ö—Ç–æ —Å–∞–º—ã–π —Å–ø–æ–Ω—Ç–∞–Ω–Ω—ã–π?",
    "–ö—Ç–æ —á–∞—â–µ –ø–∏—à–µ—Ç —á—Ç–æ-—Ç–æ —Ç–≤–æ—Ä—á–µ—Å–∫–æ–µ?",
    "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –Ω–æ–≤–æ—Å—Ç–∏?",
    "–ö—Ç–æ —á–∞—â–µ –¥–µ–ª–∞–µ—Ç —Å—Ç—Ä–∞–Ω–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏?",
    "–ö—Ç–æ –ª—É—á—à–µ –≥–æ—Ç–æ–≤ –¥–µ–ª–∏—Ç—å—Å—è?",
    "–ö—Ç–æ —á–∞—â–µ –∑–∞–±—ã–≤–∞–µ—Ç –¥–Ω–∏ —Ä–æ–∂–¥–µ–Ω–∏—è?",
    "–ö—Ç–æ —á–∞—â–µ –±–µ—Ä—ë—Ç –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É –≤ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞—Ö?",
    "–ö—Ç–æ –≥—Ä–æ–º—á–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –º–µ–º—ã?",
    "–ö—Ç–æ —á–∞—â–µ —à—É—Ç–∏—Ç –ø—Ä–æ —Ä–∞–±–æ—Ç—É?",
    "–ö—Ç–æ –±–æ–ª—å—à–µ –ª—é–±–∏—Ç —Å–ø–æ–Ω—Ç–∞–Ω–Ω—ã–µ –≤–µ—á–µ—Ä–∏–Ω–∫–∏?",
    "–ö—Ç–æ —á–∞—â–µ –¥–µ–ª–∞–µ—Ç –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç—ã –Ω–µ–∑–Ω–∞–∫–æ–º—Ü–∞–º?",
    "–ö—Ç–æ –ª—É—á—à–µ –∑–Ω–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞?",
    "–ö—Ç–æ —á–∞—â–µ —Å–º–µ—ë—Ç—Å—è –Ω–∞–¥ —Å–æ–±–æ–π?",
    "–ö—Ç–æ —Ç–∞ —Å–∞–º–∞—è –±–µ—Å—Ç–∏—è?"
]

# =======================
# –í–û–ü–†–û–°–´ ‚Äî –ü–û–î –ö–û–§–ï
# =======================

QUESTIONS_COFFEE = [
    "–ï—Å–ª–∏ –º—ã –Ω–µ –∑–Ω–∞–∫–æ–º—ã, –∞ —Ç–µ–±–µ –¥–µ–ª–∞—é—Ç –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç ‚Äî –∫–∞–∫ —Ä–µ–∞–≥–∏—Ä—É–µ—à—å?",
    "–¢—ã –ø—Ä–∏—à–ª–∞ –Ω–∞ –∫–æ—Ñ–µ –∏ –≤–∏–¥–∏—à—å –Ω–æ–≤—ã–π –¥–µ—Å–µ—Ä—Ç ‚Äî —á—Ç–æ —Å–¥–µ–ª–∞–µ—à—å?",
    "–ï—Å–ª–∏ —É–≤–∏–¥–∏—à—å –Ω–µ–∑–Ω–∞–∫–æ–º–∫—É —Å —Ç–∞–∫–æ–π –∂–µ —Å—É–º–∫–æ–π, —á—Ç–æ –ø–æ–¥—É–º–∞–µ—à—å?",
    "–¢–≤–æ–π –ª—é–±–∏–º—ã–π —Å–ø–æ—Å–æ–± –ø–æ–∑–Ω–∞–∫–æ–º–∏—Ç—å—Å—è?",
    "–ß—Ç–æ —Å–∫–∞–∑–∞—Ç—å –≤ –ø–µ—Ä–≤–æ–º —Ä–∞–∑–≥–æ–≤–æ—Ä–µ, —á—Ç–æ–±—ã –Ω–µ –±—ã–ª–æ —Å–∫—É—á–Ω–æ?",
    "–ï—Å–ª–∏ –≤ –≥—Ä—É–ø–ø–µ –∫—Ç–æ-—Ç–æ —Å—Ç—Ä–∞–Ω–Ω—ã–π, –∫–∞–∫ —Ä–µ–∞–≥–∏—Ä—É–µ—à—å?",
    "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ —Å—Ç–∞–Ω–µ—Ç —Ç–µ–±–µ –±–ª–∏–∑–∫–∏–º?",
    "–ß—Ç–æ –ø—Ä–µ–¥–ø–æ—á—Ç—ë—à—å –Ω–∞ –ø–µ—Ä–≤–æ–º –∑–Ω–∞–∫–æ–º—Å—Ç–≤–µ?",
    "–ï—Å–ª–∏ —Å–ø—Ä–æ—Å—è—Ç –ø—Ä–æ —Ä–∞–±–æ—Ç—É ‚Äî –∫–∞–∫ –æ—Ç–≤–µ—Ç–∏—à—å?",
    "–ö–∞–∫ –ª—É—á—à–µ –≤—Å–µ–≥–æ —Å–ª–æ–º–∞—Ç—å –ª—ë–¥?",
    "–ö—Ç–æ —á–∞—â–µ –∑–∞–¥–∞—ë—Ç –≤–æ–ø—Ä–æ—Å—ã –ø–µ—Ä–≤—ã–º?",
    "–ß—Ç–æ –ø–æ–º–æ–≥–∞–µ—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä—É –ø–æ–π—Ç–∏?",
    "–ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ —Ä–∞—Å—Å–∫–∞–∂–µ—Ç —Å–º–µ—à–Ω—É—é –∏—Å—Ç–æ—Ä–∏—é ‚Äî –∫–∞–∫ —Ä–µ–∞–≥–∏—Ä—É–µ—à—å?",
    "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ —Ä–∞—Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è?",
    "–ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ –æ–ø–æ–∑–¥–∞–µ—Ç ‚Äî —á—Ç–æ –ø–æ–¥—É–º–∞–µ—à—å?",
    "–ö—Ç–æ —á–∞—â–µ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Ç–µ–º—ã?",
    "–ö—Ç–æ —Å–º–µ—ë—Ç—Å—è –≥—Ä–æ–º—á–µ?",
    "–ö–∞–∫–æ–µ –ø–µ—Ä–≤–æ–µ –≤–ø–µ—á–∞—Ç–ª–µ–Ω–∏–µ –≤–∞–∂–Ω–µ–µ –≤—Å–µ–≥–æ?",
    "–ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ –ø–æ–¥–µ–ª–∏—Ç—Å—è —Å–µ–∫—Ä–µ—Ç–æ–º ‚Äî –∫–∞–∫ —Ä–µ–∞–≥–∏—Ä—É–µ—à—å?",
    "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –∑–∞–≤–æ–¥–∏—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä?",
    "–ö—Ç–æ —á–∞—â–µ –¥–µ–ª–∏—Ç—Å—è –∏—Å—Ç–æ—Ä–∏—è–º–∏?",
    "–ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ –º–æ–ª—á–∏—Ç ‚Äî –∫–∞–∫ —Ä–∞–∑—Ä—è–¥–∏—à—å –æ–±—Å—Ç–∞–Ω–æ–≤–∫—É?",
    "–ß—Ç–æ —Å–∫–∞–∂–µ—à—å –≤ –Ω–µ–ª–æ–≤–∫–æ–π –ø–∞—É–∑–µ?",
    "–ö–∞–∫ –ø–æ–Ω—è—Ç—å, —á—Ç–æ —Å —á–µ–ª–æ–≤–µ–∫–æ–º –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ?",
    "–ö—Ç–æ —á–∞—â–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –º–µ–º—ã?",
    "–ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ —Ä–∞—Å—Å–∫–∞–∂–µ—Ç –ø—Ä–æ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ ‚Äî –∫–∞–∫ –æ—Ç—Ä–µ–∞–≥–∏—Ä—É–µ—à—å?",
    "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ —Å–æ–≥–ª–∞—à–∞–µ—Ç—Å—è –Ω–∞ —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç—å?",
    "–ö—Ç–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–∑–≥–æ–≤–æ—Ä?",
    "–ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ —Ä–∞—Å—Å–∫–∞–∂–µ—Ç –Ω–µ–ª–æ–≤–∫–∏–π —Å–ª—É—á–∞–π ‚Äî —á—Ç–æ —Å–¥–µ–ª–∞–µ—à—å?",
    "–ö–∞–∫ —Ä–µ–∞–≥–∏—Ä—É–µ—à—å –Ω–∞ —Å—Ç—Ä–∞–Ω–Ω—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏?",
    "–ö—Ç–æ —á–∞—â–µ –ø—Ä–æ—è–≤–ª—è–µ—Ç –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É?",
    "–ß—Ç–æ —Å–∫–∞–∂–µ—à—å –ø—Ä–∏ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–µ —Å—Ä–∞–∑—É —Å –Ω–µ—Å–∫–æ–ª—å–∫–∏–º–∏?",
    "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ —Å–±–ª–∏–∂–∞–µ—Ç—Å—è?",
    "–ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ —Å–ª–∏—à–∫–æ–º —Å–µ—Ä—å—ë–∑–Ω—ã–π ‚Äî –∫–∞–∫ —Ä–µ–∞–≥–∏—Ä—É–µ—à—å?",
    "–ö—Ç–æ —Å–º–µ—ë—Ç—Å—è –Ω–∞–¥ –Ω–µ–ª–æ–≤–∫–æ—Å—Ç—è–º–∏?",
    "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –Ω–∞—á–∏–Ω–∞–µ—Ç –¥–æ–≤–µ—Ä—è—Ç—å?",
    "–ö—Ç–æ —á–∞—â–µ –±–µ—Ä—ë—Ç –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É?",
    "–ö—Ç–æ —Å–º–µ—ë—Ç—Å—è –ø–µ—Ä–≤—ã–º?",
    "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –≤–∫–ª—é—á–∞–µ—Ç—Å—è –≤ –±–µ—Å–µ–¥—É?",
    "–ö—Ç–æ –¥–µ–ª–∞–µ—Ç –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç—ã –Ω–æ–≤—ã–º –ª—é–¥—è–º?",
    "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –¥–µ–ª–∏—Ç—Å—è –ª–∏—á–Ω—ã–º?",
    "–ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ —Ä–∞—Å—Å–∫–∞–∂–µ—Ç –∫—Ä–∏–Ω–∂ ‚Äî –∫–∞–∫ –æ—Ç—Ä–µ–∞–≥–∏—Ä—É–µ—à—å?",
    "–ö—Ç–æ —á–∞—â–µ –∑–∞–¥–∞—ë—Ç –≤–æ–ø—Ä–æ—Å—ã?",
    "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç—Å—è?",
    "–ö—Ç–æ —Å–º–µ—ë—Ç—Å—è –Ω–∞–¥ —á—É–∂–∏–º–∏ —à—É—Ç–∫–∞–º–∏?",
    "–ö—Ç–æ –ø–µ—Ä–≤—ã–º –∑–∞–≥–æ–≤–æ—Ä–∏—Ç?",
    "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –æ—Ç—Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –∏—Å—Ç–æ—Ä–∏—é?",
    "–ö—Ç–æ –∞–∫—Ç–∏–≤–Ω–µ–µ –≤ –≥—Ä—É–ø–ø–µ?",
    "–ö—Ç–æ —á–∞—â–µ —Å–º–µ—ë—Ç—Å—è?",
    "–° –∫–µ–º –±—ã–ª–æ –±—ã –ø—Ä–∏—è—Ç–Ω–æ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –≤–µ—á–µ—Ä?"
]

# =======================
# –°–õ–£–ñ–ï–ë–ù–û–ï
# =======================

FUN_COMMENTS = [
    "üòÇ –ù—É –≤—ã –¥–∞—ë—Ç–µ",
    "ü§£ –û—Ç–ª–∏—á–Ω–æ –ø–æ—à–ª–æ",
    "üòè –ê—Ç–º–æ—Å—Ñ–µ—Ä–∞ –µ—Å—Ç—å",
    "üî• –≠—Ç–æ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ",
    "ü•Ç –ü—Ä–æ–¥–æ–ª–∂–∞–µ–º"
]

GAMES = {}

class GameState:
    def __init__(self, mode):
        self.mode = mode
        self.index = 0
        self.started = False

def mode_keyboard():
    return InlineKeyboardMarkup([
        [InlineKeyboardButton("üç∑ –ú–æ—è –ë–µ—Å—Ç–∏—è", callback_data="mode_bestia")],
        [InlineKeyboardButton("‚òï –ú–µ–∂–¥—É –Ω–∞–º–∏, –¥–µ–≤–æ—á–∫–∞–º–∏", callback_data="mode_coffee")]
    ])

def ready_keyboard():
    return InlineKeyboardMarkup([
        [InlineKeyboardButton("‚úÖ –ì–û–¢–û–í–û", callback_data="ready")]
    ])

# =======================
# –•–≠–ù–î–õ–ï–†–´
# =======================

async def start(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text("üíñ /newgame ‚Äî –Ω–∞—á–∞—Ç—å –∏–≥—Ä—É")

async def newgame(update: Update, context: ContextTypes.DEFAULT_TYPE):
    await update.message.reply_text("–í—ã–±–µ—Ä–∏—Ç–µ —Ä–µ–∂–∏–º:", reply_markup=mode_keyboard())

async def choose_mode(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()

    chat_id = query.message.chat.id
    mode = "bestia" if query.data == "mode_bestia" else "coffee"
    GAMES[chat_id] = GameState(mode)

    await query.edit_message_text("–ù–∞–∂–º–∏—Ç–µ –ì–û–¢–û–í–û üëá", reply_markup=ready_keyboard())

async def ready(update: Update, context: ContextTypes.DEFAULT_TYPE):
    query = update.callback_query
    await query.answer()
    chat_id = query.message.chat.id

    GAMES[chat_id].started = True
    await send_question(chat_id, context)

async def send_question(chat_id, context):
    game = GAMES.get(chat_id)
    if not game:
        return

    questions = QUESTIONS_BESTIA if game.mode == "bestia" else QUESTIONS_COFFEE

    if game.index >= len(questions):
        await context.bot.send_message(chat_id, "üéâ –ò–≥—Ä–∞ –∑–∞–∫–æ–Ω—á–µ–Ω–∞!")
        GAMES.pop(chat_id)
        return

    q = questions[game.index]
    game.index += 1

    await context.bot.send_message(chat_id, f"‚ùì {q}")

async def any_message(update: Update, context: ContextTypes.DEFAULT_TYPE):
    chat_id = update.effective_chat.id
    if chat_id not in GAMES or not GAMES[chat_id].started:
        return

    await context.bot.send_message(chat_id, random.choice(FUN_COMMENTS))
    await send_question(chat_id, context)

# =======================
# –ó–ê–ü–£–°–ö
# =======================

def main():
    token = os.getenv("BOT_TOKEN")
    if not token:
        raise RuntimeError("BOT_TOKEN not set")

    app = Application.builder().token(token).build()
    app.add_handler(CommandHandler("start", start))
    app.add_handler(CommandHandler("newgame", newgame))
    app.add_handler(CallbackQueryHandler(choose_mode, pattern="mode_.*"))
    app.add_handler(CallbackQueryHandler(ready, pattern="ready"))
    app.add_handler(MessageHandler(filters.TEXT & ~filters.COMMAND, any_message))
    app.run_polling()

if __name__ == "__main__":
    main()

