import os
import logging
import random

from aiogram import Bot, Dispatcher, types
from aiogram.types import ReplyKeyboardMarkup, KeyboardButton
from aiogram.utils import executor

API_TOKEN = os.getenv("BOT_TOKEN") 

logging.basicConfig(level=logging.INFO)

bot = Bot(token=API_TOKEN)
dp = Dispatcher(bot)

# =======================
# –°–û–°–¢–û–Ø–ù–ò–ï –ò–ì–†–´
# fix=======================
games = {}  # chat_id -> dict


# =======================
# –í–û–ü–†–û–°–´ ‚Äî üç∑ –í–ò–ù–û (–¢–í–û–ô –°–ü–ò–°–û–ö, –ù–ï –ú–ï–ù–Ø–Æ)
# =======================
QUESTIONS_WINE = [
    {"q": "–¢—ã –ø–∏—à–µ—à—å ¬´–æ–∫¬ª ‚Äî —ç—Ç–æ‚Ä¶"},
    {"q": "–ï—Å–ª–∏ —è –æ–ø–∞–∑–¥—ã–≤–∞—é –Ω–∞ 20 –º–∏–Ω—É—Ç, —Ç—ã‚Ä¶"},
    {"q": "–í –ø–ª–æ—Ö–æ–º –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–∏ –º–Ω–µ –ª—É—á—à–µ –ø—Ä–∏—Å–ª–∞—Ç—å‚Ä¶"},
    {"q": "–ú—ã –º–æ–∂–µ–º –Ω–µ –æ–±—â–∞—Ç—å—Å—è –º–µ—Å—è—Ü –∏ –Ω–µ –æ–±–∏–∂–∞—Ç—å—Å—è?"},
    {"q": "–ï—Å–ª–∏ –º—ã –ø–æ—Å—Å–æ—Ä–∏–ª–∏—Å—å ‚Äî –∫—Ç–æ –ø–µ—Ä–≤—ã–π –ø—Ä–∏—à–ª—ë—Ç –º–µ–º?"},
    {"q": "–ö–∞–∫—É—é —Å–∞–º—É—é —Å—Ç—Ä–∞–Ω–Ω—É—é –ø—Ä–∏–≤—ã—á–∫—É —É –º–µ–Ω—è –∑–Ω–∞–µ—à—å?"},
    {"q": "–ï—Å–ª–∏ –º—ã –∏–¥—ë–º –Ω–∞ –≤–µ—á–µ—Ä–∏–Ω–∫—É –≤–º–µ—Å—Ç–µ, –∫—Ç–æ –ø–æ—Ç–µ—Ä—è–µ—Ç—Å—è –ø–µ—Ä–≤—ã–º?"},
    {"q": "–ö—Ç–æ –∏–∑ –Ω–∞—Å –±–æ–ª—å—à–µ –ª—é–±–∏—Ç –∫–æ—Ñ–µ?"},
    {"q": "–ï—Å–ª–∏ –≤–¥—Ä—É–≥ –Ω–∞—á–Ω—ë—Ç—Å—è —Ç–∞–Ω—Ü–µ–≤–∞–ª—å–Ω—ã–π –±–∞—Ç—Ç–ª, –∫—Ç–æ –≤—ã–∏–≥—Ä–∞–µ—Ç?"},
    {"q": "–ö—Ç–æ —á–∞—â–µ –∑–∞–±—ã–≤–∞–µ—Ç –∫–ª—é—á–∏?"},
    {"q": "–° –∫–µ–º –ª–µ–≥—á–µ –ø–æ–¥–µ–ª–∏—Ç—å—Å—è —Å–µ–∫—Ä–µ—Ç–æ–º?"},
    {"q": "–ö—Ç–æ –≥—Ä–æ–º—á–µ —Å–º–µ—ë—Ç—Å—è?"},
    {"q": "–ï—Å–ª–∏ –±—ã –º—ã —Å—Ç–∞–ª–∏ —Å—É–ø–µ—Ä–≥–µ—Ä–æ—è–º–∏, –∫—Ç–æ –±—ã –±—ã–ª‚Ä¶"},
    {"q": "–ö—Ç–æ —á–∞—â–µ –Ω–∞—á–∏–Ω–∞–µ—Ç —Å–ø–æ—Ä—ã?"},
    {"q": "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –µ—Å—Ç —Å–ª–∞–¥–∫–æ–µ?"},
    {"q": "–ö—Ç–æ –ª—É—á—à–µ –≥–æ—Ç–æ–≤–∏—Ç –º–µ–º—ã?"},
    {"q": "–ï—Å–ª–∏ —è –ø–ª–∞—á—É –Ω–∞–¥ —Å–µ—Ä–∏–∞–ª–æ–º, –∫—Ç–æ –º–µ–Ω—è –ø–æ–π–º—ë—Ç?"},
    {"q": "–ö—Ç–æ —á–∞—â–µ —Å—Ç–∞–≤–∏—Ç –ª–∞–π–∫–∏ –Ω–∞ —Å—Ç–æ—Ä–∏—Å?"},
    {"q": "–ï—Å–ª–∏ —á—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫, –∫—Ç–æ –±—ã—Å—Ç—Ä–µ–µ —Å–¥–∞—ë—Ç—Å—è?"},
    {"q": "–ö—Ç–æ –∏–∑ –Ω–∞—Å –±–æ–ª—å—à–µ –ª—é–±–∏—Ç –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è?"},
    {"q": "–ö—Ç–æ –ª—É—á—à–µ —Ö—Ä–∞–Ω–∏—Ç —Å–µ–∫—Ä–µ—Ç—ã?"},
    {"q": "–ï—Å–ª–∏ –∫—Ç–æ-—Ç–æ —Å–∫—É—á–∞–µ—Ç, –∫—Ç–æ –ø–µ—Ä–≤—ã–º –Ω–∞–ø–∏—à–µ—Ç?"},
    {"q": "–ö—Ç–æ —á–∞—â–µ –¥–µ–ª–∞–µ—Ç —Å–º–µ—à–Ω—ã–µ —Å–µ–ª—Ñ–∏?"},
    {"q": "–ö—Ç–æ —á–∞—â–µ —Å–ø–æ—Ä–∏—Ç –æ —Ñ–∏–ª—å–º–∞—Ö?"},
    {"q": "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è?"},
    {"q": "–ö—Ç–æ —á–∞—â–µ –±–µ—Ä—ë—Ç –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É?"},
    {"q": "–ï—Å–ª–∏ —è –≥—Ä—É—â—É, –∫—Ç–æ –º–µ–Ω—è —Ä–∞–∑–≤–µ—Å–µ–ª–∏—Ç?"},
    {"q": "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –Ω–∞—á–∏–Ω–∞–µ—Ç —à—É—Ç–∏—Ç—å?"},
    {"q": "–ï—Å–ª–∏ –∏–¥—ë–º –≤ –º–∞–≥–∞–∑–∏–Ω, –∫—Ç–æ –±–æ–ª—å—à–µ –ø–æ–∫—É–ø–∞–µ—Ç?"},
    {"q": "–ö—Ç–æ —á–∞—â–µ –æ—Ä–≥–∞–Ω–∏–∑—É–µ—Ç –≤—Å—Ç—Ä–µ—á–∏?"},
    {"q": "–ö—Ç–æ —á–∞—â–µ –æ–ø–∞–∑–¥—ã–≤–∞–µ—Ç –Ω–∞ –≤—Å—Ç—Ä–µ—á–∏?"},
    {"q": "–ö—Ç–æ —Å–º–µ—à–Ω–µ–µ —à—É—Ç–∏—Ç?"},
    {"q": "–ö—Ç–æ –ª—É—á—à–µ –∑–∞–ø–æ–º–∏–Ω–∞–µ—Ç –∏–º–µ–Ω–∞?"},
    {"q": "–ö—Ç–æ —á–∞—â–µ –ø—Ä–µ–¥–ª–∞–≥–∞–µ—Ç –∏–¥–µ–∏?"},
    {"q": "–ö—Ç–æ —Å–∏–ª—å–Ω–µ–µ –≤–ª–∏—è–µ—Ç –Ω–∞ –¥—Ä—É–≥–∏—Ö?"},
    {"q": "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –Ω–∞—Ö–æ–¥–∏—Ç –º–µ–º—ã?"},
    {"q": "–ö—Ç–æ —á–∞—â–µ –¥–µ–ª–∞–µ—Ç –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç—ã?"},
    {"q": "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ –æ—Å–≤–∞–∏–≤–∞–µ—Ç –Ω–æ–≤—ã–µ –ø—Ä–∏–≤—ã—á–∫–∏?"},
    {"q": "–ö—Ç–æ —á–∞—â–µ —à—É—Ç–∏—Ç –ø—Ä–æ –µ–¥—É?"},
    {"q": "–ö—Ç–æ –≥—Ä–æ–º—á–µ —Å–º–µ—ë—Ç—Å—è –Ω–∞–¥ –º–µ–º–∞–º–∏?"},
    {"q": "–ö—Ç–æ —á–∞—â–µ —Ç–µ—Ä—è–µ—Ç –≤–µ—â–∏?"},
    {"q": "–ö—Ç–æ –∏–∑ –Ω–∞—Å –±–æ–ª—å—à–µ —Å–ø–æ–Ω—Ç–∞–Ω–Ω—ã–π?"},
    {"q": "–ö—Ç–æ —á–∞—â–µ –ø–∏—à–µ—Ç –ø–µ—Å–Ω–∏, —Å—Ç–∏—Ö–∏ –∏–ª–∏ —à—É—Ç–∫–∏?"},
    {"q": "–ö—Ç–æ –±—ã—Å—Ç—Ä–µ–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –Ω–æ–≤–æ—Å—Ç–∏?"},
    {"q": "–ö—Ç–æ —á–∞—â–µ –¥–µ–ª–∞–µ—Ç –Ω–µ–æ–±—ã—á–Ω—ã–µ –ø–æ–∫—É–ø–∫–∏?"},
    {"q": "–ö—Ç–æ –ª—É—á—à–µ –≥–æ—Ç–æ–≤ –¥–µ–ª–∏—Ç—å—Å—è?"},
    {"q": "–ö—Ç–æ —á–∞—â–µ –∑–∞–±—ã–≤–∞–µ—Ç –¥–Ω–∏ —Ä–æ–∂–¥–µ–Ω–∏—è?"},
    {"q": "–ö—Ç–æ —á–∞—â–µ –±–µ—Ä—ë—Ç –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É –≤ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞—Ö?"},
    {"q": "–ö—Ç–æ –≥—Ä–æ–º—á–µ —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ –º–µ–º—ã?"},
    {"q": "–ö—Ç–æ —á–∞—â–µ —à—É—Ç–∏—Ç –ø—Ä–æ —Ä–∞–±–æ—Ç—É?"},
    {"q": "–ö—Ç–æ –±–æ–ª—å—à–µ –ª—é–±–∏—Ç —Å–ø–æ–Ω—Ç–∞–Ω–Ω—ã–µ –≤–µ—á–µ—Ä–∏–Ω–∫–∏?"},
    {"q": "–ö—Ç–æ —á–∞—â–µ –¥–µ–ª–∞–µ—Ç –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç—ã –Ω–µ–∑–Ω–∞–∫–æ–º—Ü–∞–º?"},
    {"q": "–ö—Ç–æ –ª—É—á—à–µ –∑–Ω–∞–µ—Ç –∏—Å—Ç–æ—Ä–∏–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞?"},
    {"q": "–ö—Ç–æ —á–∞—â–µ —Å–º–µ—ë—Ç—Å—è –Ω–∞–¥ —Å–æ–±–æ–π?"}
]


# =======================
# –í–û–ü–†–û–°–´ ‚Äî ‚òï –ö–û–§–ï (–ù–û–í–´–ï 40, –ù–ï –î–£–ë–õ–Ø–¢–°–Ø –° –í–ò–ù–ù–´–ú–ò)
# =======================
QUESTIONS_COFFEE = [
    {"q": "–ö–∞–∫–æ–µ —É —Ç–µ–±—è –±—ã–ª–æ —Å–∞–º–æ–µ –ª—é–±–∏–º–æ–µ –∑–∞–Ω—è—Ç–∏–µ –≤ –¥–µ—Ç—Å—Ç–≤–µ?"},
    {"q": "–ö–∞–∫–æ–π –º—É–ª—å—Ç—Ñ–∏–ª—å–º —Ç—ã –º–æ–≥–ª–∞ –ø–µ—Ä–µ—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ?"},
    {"q": "–ß—Ç–æ —Ç—ã –≤—Å–µ–≥–¥–∞ –±—Ä–∞–ª–∞ —Å —Å–æ–±–æ–π –≤ —à–∫–æ–ª—É –∏–ª–∏ —Å–∞–¥–∏–∫, –¥–∞–∂–µ –µ—Å–ª–∏ –Ω–µ –Ω—É–∂–Ω–æ –±—ã–ª–æ?"},
    {"q": "–ö–∞–∫–∞—è –µ–¥–∞ —Å—Ä–∞–∑—É –ø–µ—Ä–µ–Ω–æ—Å–∏—Ç —Ç–µ–±—è –≤ –¥–µ—Ç—Å—Ç–≤–æ?"},
    {"q": "–ö–µ–º —Ç—ã –º–µ—á—Ç–∞–ª–∞ —Å—Ç–∞—Ç—å, –∫–æ–≥–¥–∞ –±—ã–ª–∞ –º–∞–ª–µ–Ω—å–∫–æ–π?"},
    {"q": "–ë—ã–ª–∞ –ª–∏ —É —Ç–µ–±—è –ª—é–±–∏–º–∞—è –∏–≥—Ä—É—à–∫–∞, –±–µ–∑ –∫–æ—Ç–æ—Ä–æ–π –Ω–µ–ª—å–∑—è –±—ã–ª–æ —É—Å–Ω—É—Ç—å?"},
    {"q": "–ö–∞–∫–æ–π –∑–∞–ø–∞—Ö —É —Ç–µ–±—è –∞—Å—Å–æ—Ü–∏–∏—Ä—É–µ—Ç—Å—è —Å –¥–æ–º–æ–º?"},
    {"q": "–ó–∞ —á—Ç–æ —Ç–µ–±—è —á–∞—â–µ –≤—Å–µ–≥–æ —Ö–≤–∞–ª–∏–ª–∏ –≤ –¥–µ—Ç—Å—Ç–≤–µ?"},
    {"q": "–ö–∞–∫—É—é —Å–∞–º—É—é —Å–º–µ—à–Ω—É—é –∫–ª–∏—á–∫—É —Ç–µ–±–µ –∫–æ–≥–¥–∞-–ª–∏–±–æ –¥–∞–≤–∞–ª–∏?"},
    {"q": "–ö–∞–∫–æ–π –º–æ–º–µ–Ω—Ç –∏–∑ –¥–µ—Ç—Å—Ç–≤–∞ –¥–æ —Å–∏—Ö –ø–æ—Ä –≤—ã–∑—ã–≤–∞–µ—Ç —É–ª—ã–±–∫—É?"},
    {"q": "–ß—Ç–æ —Ç—ã –¥–µ–ª–∞–ª–∞, –∫–æ–≥–¥–∞ —Ö–æ—Ç–µ–ª–∞, —á—Ç–æ–±—ã —Ç–µ–±—è –æ—Å—Ç–∞–≤–∏–ª–∏ –≤ –ø–æ–∫–æ–µ?"},
    {"q": "–ö–∞–∫—É—é –µ—Ä—É–Ω–¥—É —Ç—ã –æ–±–æ–∂–∞–ª–∞, —Ö–æ—Ç—è –≤–∑—Ä–æ—Å–ª—ã–µ –Ω–µ –ø–æ–Ω–∏–º–∞–ª–∏ –ø–æ—á–µ–º—É?"},
    {"q": "–ö–∞–∫–æ–π –±—ã–ª —Ç–≤–æ–π —Å–∞–º—ã–π –ª—é–±–∏–º—ã–π –ø—Ä–∞–∑–¥–Ω–∏–∫ –≤ –¥–µ—Ç—Å—Ç–≤–µ?"},
    {"q": "–ï—Å–ª–∏ –±—ã –º–æ–∂–Ω–æ –±—ã–ª–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –Ω–∞ –æ–¥–∏–Ω –¥–µ–Ω—å –≤ –¥–µ—Ç—Å—Ç–≤–æ ‚Äî –∫—É–¥–∞ –±—ã —Ç—ã –ø–æ—à–ª–∞?"},
    {"q": "–ö–∞–∫–æ–π —É —Ç–µ–±—è –±—ã–ª —Å–∞–º—ã–π —Å–º–µ—à–Ω–æ–π —Å—Ç—Ä–∞—Ö –≤ –¥–µ—Ç—Å—Ç–≤–µ?"},
    {"q": "–ß—Ç–æ —Ç—ã –¥–µ–ª–∞–ª–∞, –∫–æ–≥–¥–∞ –æ—Å—Ç–∞–≤–∞–ª–∞—Å—å –æ–¥–Ω–∞ –¥–æ–º–∞?"},
    {"q": "–ö–∞–∫–æ–π —Å–∞–º—ã–π —Ç—ë–ø–ª—ã–π —Å–µ–º–µ–π–Ω—ã–π —Ä–∏—Ç—É–∞–ª —Ç—ã –ø–æ–º–Ω–∏—à—å?"},
    {"q": "–ß—Ç–æ —Ç—ã –æ–±–æ–∂–∞–ª–∞ –¥–µ–ª–∞—Ç—å, –∫–æ–≥–¥–∞ —à—ë–ª –¥–æ–∂–¥—å?"},
    {"q": "–ö–∞–∫—É—é –º–µ–ª–æ—á—å —Ç—ã –¥–æ —Å–∏—Ö –ø–æ—Ä —Ö—Ä–∞–Ω–∏—à—å ¬´–Ω–∞ –ø–∞–º—è—Ç—å¬ª?"},
    {"q": "–ö–∞–∫–æ–π –±—ã–ª —Ç–≤–æ–π –∫–æ—Ä–æ–Ω–Ω—ã–π —Å–ø–æ—Å–æ–± –ø–æ–¥–Ω–∏–º–∞—Ç—å —Å–µ–±–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ?"},
    {"q": "–ß—Ç–æ —Ç–µ–±—è –≤—Å–µ–≥–¥–∞ —Å–º–µ—à–∏–ª–æ, –¥–∞–∂–µ –∫–æ–≥–¥–∞ –Ω–µ–ª—å–∑—è –±—ã–ª–æ —Å–º–µ—è—Ç—å—Å—è?"},
    {"q": "–ö–∞–∫–æ–π –º–æ–º–µ–Ω—Ç —Ç—ã –±—ã —Ö–æ—Ç–µ–ª–∞ –ø–µ—Ä–µ–∂–∏—Ç—å –µ—â—ë —Ä–∞–∑?"},
    {"q": "–ß—Ç–æ —Ç—ã –¥–µ–ª–∞–ª–∞, —á—Ç–æ–±—ã –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–µ–±—è —Å–º–µ–ª–æ–π?"},
    {"q": "–ö–∞–∫–æ–π –±—ã–ª —Ç–≤–æ–π —Å–∞–º—ã–π —É—é—Ç–Ω—ã–π —É–≥–æ–ª–æ–∫?"},
    {"q": "–ö–∞–∫–∞—è –ø—Ä–∏–≤—ã—á–∫–∞ –∏–∑ –¥–µ—Ç—Å—Ç–≤–∞ –æ—Å—Ç–∞–ª–∞—Å—å —Å —Ç–æ–±–æ–π –¥–æ —Å–∏—Ö –ø–æ—Ä?"},
    {"q": "–ö–∞–∫–æ–π –∫–æ–º–ø–ª–∏–º–µ–Ω—Ç —Ç—ã –∑–∞–ø–æ–º–Ω–∏–ª–∞ –Ω–∞ –≤—Å—é –∂–∏–∑–Ω—å?"},
    {"q": "–ß—Ç–æ —Ç—ã —Å—á–∏—Ç–∞–ª–∞ –Ω–∞—Å—Ç–æ—è—â–∏–º —Å—á–∞—Å—Ç—å–µ–º, –∫–æ–≥–¥–∞ –±—ã–ª–∞ –º–∞–ª–µ–Ω—å–∫–æ–π?"},
    {"q": "–ö–∞–∫–æ–π –¥–µ–Ω—å –∏–∑ –¥–µ—Ç—Å—Ç–≤–∞ —Ç—ã –ø–æ–º–Ω–∏—à—å –æ—Å–æ–±–µ–Ω–Ω–æ —á—ë—Ç–∫–æ?"},
    {"q": "–ß—Ç–æ —Ç–µ–±—è –≤—Å–µ–≥–¥–∞ —É—Å–ø–æ–∫–∞–∏–≤–∞–ª–æ?"},
    {"q": "–ö–∞–∫–æ–π –ø—Ä–æ—Å—Ç–æ–π –º–æ–º–µ–Ω—Ç —Ç–æ–≥–¥–∞ –∫–∞–∑–∞–ª—Å—è –≤–æ–ª—à–µ–±–Ω—ã–º?"},
    {"q": "–ß—Ç–æ —Ç—ã –ª—é–±–∏–ª–∞ –¥–µ–ª–∞—Ç—å –ø–µ—Ä–µ–¥ —Å–Ω–æ–º?"},
    {"q": "–ö–∞–∫—É—é —Å–º–µ—à–Ω—É—é —Ç—Ä–∞–¥–∏—Ü–∏—é —Ç—ã –ø—Ä–∏–¥—É–º–∞–ª–∞ —Å–∞–º–∞?"},
    {"q": "–ß—Ç–æ –¥–µ–ª–∞–ª–æ —Ç–≤–æ–π –¥–µ–Ω—å —Å—Ä–∞–∑—É —Ö–æ—Ä–æ—à–∏–º?"},
    {"q": "–ö–∞–∫–∞—è –º–µ–ª–æ—á—å –º–æ–≥–ª–∞ —Å–¥–µ–ª–∞—Ç—å —Ç–µ–±—è –±–µ–∑—É–º–Ω–æ —Å—á–∞—Å—Ç–ª–∏–≤–æ–π?"},
    {"q": "–ö–∞–∫–æ–π –∑–≤—É–∫ –∏–ª–∏ —Ñ—Ä–∞–∑–∞ —Å—Ä–∞–∑—É –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ –¥–µ—Ç—Å—Ç–≤–æ?"},
    {"q": "–ß—Ç–æ —Ç—ã –¥–µ–ª–∞–ª–∞ –ø—Ä–æ—Å—Ç–æ –ø–æ—Ç–æ–º—É, —á—Ç–æ –±—ã–ª–æ –ø—Ä–∏—è—Ç–Ω–æ?"},
    {"q": "–ö–∞–∫–æ–π –º–æ–º–µ–Ω—Ç –∏–∑ –¥–µ—Ç—Å—Ç–≤–∞ —Ç—ã —Ä–µ–¥–∫–æ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞–µ—à—å, –Ω–æ –ª—é–±–∏—à—å –≤—Å–ø–æ–º–∏–Ω–∞—Ç—å?"},
    {"q": "–ß—Ç–æ —Ç—ã —Ö–æ—Ç–µ–ª–∞ –±—ã —Å–∫–∞–∑–∞—Ç—å —Å–µ–±–µ –º–∞–ª–µ–Ω—å–∫–æ–π —Å–µ–π—á–∞—Å?"},
    {"q": "–ö–∞–∫–æ–π —Ç—ã –±—ã–ª–∞, –∫–æ–≥–¥–∞ —á—É–≤—Å—Ç–≤–æ–≤–∞–ª–∞ —Å–µ–±—è —Å–∞–º–æ–π —Å–æ–±–æ–π?"}
]


# =======================
# –ö–û–ú–ú–ï–ù–¢–ê–†–ò–ò (–ù–ï –ú–ï–ù–Ø–Æ)
# =======================
COMMENTS_COFFEE = [
    "‚òï –ü–æ–¥ –∫–æ—Ñ–µ —ç—Ç–æ –∑–≤—É—á–∏—Ç –æ—Å–æ–±–µ–Ω–Ω–æ —á–µ—Å—Ç–Ω–æ",
    "‚òï –¢—É—Ç —è–≤–Ω–æ –±—ã–ª–æ –±–µ–∑ —Ñ–∏–ª—å—Ç—Ä–æ–≤",
    "‚òï –ö–∞–∂–µ—Ç—Å—è, —É –∫–æ–≥–æ-—Ç–æ –∏–Ω—Å–∞–π—Ç"
]

COMMENTS_WINE = [
    "üç∑ –ü–æ–¥ –±–æ–∫–∞–ª –≤–∏–Ω–∞ —Ç–∞–∫–∏–µ –æ—Ç–≤–µ—Ç—ã —Å–º–µ–ª–µ–µ",
    "üç∑ –≠—Ç–æ —Ç–æ—á–Ω–æ —Å–∫–∞–∑–∞–Ω–æ –Ω–µ –Ω–∞ —Ç—Ä–µ–∑–≤—É—é –≥–æ–ª–æ–≤—É",
    "üç∑ –û–π, —Ç—É—Ç –ø–æ—à–ª–∞ –ø—Ä–∞–≤–¥–∞"
]


# =======================
# –§–ò–ù–ê–õ–¨–ù–´–ï –°–õ–û–í–ê
# =======================
FINAL_TEXT_COFFEE = (
    "‚òï –°–ø–∞—Å–∏–±–æ –∑–∞ —ç—Ç–æ—Ç —Ç—ë–ø–ª—ã–π —Ä–∞–∑–≥–æ–≤–æ—Ä.\n\n"
    "–ò–Ω–æ–≥–¥–∞ —Ç–∞–∫ –≤–∞–∂–Ω–æ –ø—Ä–æ—Å—Ç–æ –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è,\n"
    "–≤—Å–ø–æ–º–Ω–∏—Ç—å —Å–µ–±—è, –ø–æ—Å–º–µ—è—Ç—å—Å—è –∏ —É—Å–ª—ã—à–∞—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥–∞.\n\n"
    "–ü—É—Å—Ç—å —ç—Ç–æ —á—É–≤—Å—Ç–≤–æ —É—é—Ç–∞ –∏ –±–ª–∏–∑–æ—Å—Ç–∏\n"
    "–æ—Å—Ç–∞–Ω–µ—Ç—Å—è —Å –≤–∞–º–∏ —á—É—Ç—å –¥–æ–ª—å—à–µ, —á–µ–º —ç—Ç–æ—Ç –≤–µ—á–µ—Ä üíõ"
)

FINAL_TEXT_WINE = (
    "üç∑ –ù—É —á—Ç–æ‚Ä¶ –≤–æ—Ç –∏ –≤—Å—è –ø—Ä–∞–≤–¥–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è üòå\n\n"
    "–°–º–µ—Ö, —á–µ—Å—Ç–Ω–æ—Å—Ç—å, –≤–∑–≥–ª—è–¥—ã –∏ —Ñ—Ä–∞–∑—ã,\n"
    "–∫–æ—Ç–æ—Ä—ã–µ –æ—Å—Ç–∞–Ω—É—Ç—Å—è –º–µ–∂–¥—É —Å–≤–æ–∏–º–∏.\n\n"
    "–ü—É—Å—Ç—å —ç—Ç–æ—Ç –≤–µ—á–µ—Ä –∑–∞–ø–æ–º–Ω–∏—Ç—Å—è\n"
    "–∫–∞–∫ —Ç–æ—Ç —Å–∞–º—ã–π ‚Äî —Ç—ë–ø–ª—ã–π, –¥–µ—Ä–∑–∫–∏–π –∏ –Ω–∞—Å—Ç–æ—è—â–∏–π ‚ú®"
)


# =======================
# –ö–ù–û–ü–ö–ò
# =======================
kb_mode = ReplyKeyboardMarkup(resize_keyboard=True)
kb_mode.add(KeyboardButton("‚òï –ö–û–§–ï"), KeyboardButton("üç∑ –í–ò–ù–û"))

kb_ready = ReplyKeyboardMarkup(resize_keyboard=True)
kb_ready.add(KeyboardButton("–ì–û–¢–û–í–û"))

kb_next = ReplyKeyboardMarkup(resize_keyboard=True)
kb_next.add(KeyboardButton("–î–ê–õ–¨–®–ï"))

kb_save = ReplyKeyboardMarkup(resize_keyboard=True)
kb_save.add(KeyboardButton("–°–û–•–†–ê–ù–ò–¢–¨ üíæ"), KeyboardButton("–ù–ê–ß–ê–¢–¨ –°–ù–û–í–ê"))


# =======================
# –£–¢–ò–õ–ò–¢–´
# =======================
def get_questions(mode: str):
    return QUESTIONS_WINE if mode == "wine" else QUESTIONS_COFFEE

def get_comments(mode: str):
    return COMMENTS_WINE if mode == "wine" else COMMENTS_COFFEE

def get_final_text(mode: str):
    return FINAL_TEXT_WINE if mode == "wine" else FINAL_TEXT_COFFEE

def fun_score(text: str) -> int:
    t = (text or "").strip().lower()
    if not t:
        return -999

    score = 0

    laugh_emojis = ["üòÇ", "ü§£", "üòπ", "üíÄ", "üò≠"]
    score += sum(3 for e in laugh_emojis if e in text)

    laugh_words = [
        "–∞—Ö–∞—Ö–∞", "–∞—Ö–∞—Ö", "—Ö–∞—Ö–∞", "—Ö–µ—Ö", "–ª–æ–ª", "–æ—Ä—É", "—Ä–∂—É",
        "—É–≥–∞—Ä", "–∫—Ä–∏–Ω–∂", "–∂–µ—Å—Ç—å", "–∫–∞–ø–µ—Ü", "–±–æ–∂–µ", "–ø–∏–ø–µ—Ü"
    ]
    score += sum(2 for w in laugh_words if w in t)

    score += min(t.count(")"), 6)
    score += min(t.count("!"), 5)
    score += min(t.count("?"), 3)

    words = [w for w in t.split() if w]
    if len(words) >= 6:
        score += 3
    elif len(words) >= 4:
        score += 2
    elif len(words) >= 2:
        score += 1
    else:
        score -= 2

    if len(t) <= 3:
        score -= 4

    return score


# =======================
# /start
# =======================
@dp.message_handler(commands=["start"])
async def start(message: types.Message):
    games[message.chat.id] = {
        "mode": None,      # "coffee" / "wine"
        "index": 0,
        "answers": [],
        "log": [],         # –æ—Ç–≤–µ—Ç—ã –∑–∞ –≤–µ—Å—å –≤–µ—á–µ—Ä
        "started": False
    }

    await message.answer(
        "‚òïüç∑ –§–û–†–ú–ê–¢ –ò–ì–†–´\n\n"
        "–ú–æ–∂–Ω–æ –∏–≥—Ä–∞—Ç—å:\n"
        "‚Äî –ø–æ–¥ —á–∞—à–∫—É –∫–æ—Ñ–µ\n"
        "‚Äî –ø–æ–¥ –±–æ–∫–∞–ª –≤–∏–Ω–∞\n\n"
        "–ú–æ–∂–Ω–æ:\n"
        "‚Äî –ø–∏—Å–∞—Ç—å –∫–æ—Ä–æ—Ç–∫–æ\n"
        "‚Äî –æ—Ç–≤–µ—á–∞—Ç—å –≤—Å–ª—É—Ö\n"
        "‚Äî –æ–±—Å—É–∂–¥–∞—Ç—å –æ—Ç–≤–µ—Ç—ã –º–µ–∂–¥—É —Å–æ–±–æ–π\n\n"
        "–≠—Ç–æ –Ω–µ —Ç–µ—Å—Ç –∏ –Ω–µ –∞–Ω–∫–µ—Ç–∞,\n"
        "–∞ –ø–æ–≤–æ–¥ –ø–æ—Å–º–µ—è—Ç—å—Å—è, –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å –∏ –ø–æ—á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å –∞—Ç–º–æ—Å—Ñ–µ—Ä—É.\n\n"
        "–í—ã–±–µ—Ä–∏ —Ä–µ–∂–∏–º –∫–Ω–æ–ø–∫–æ–π –Ω–∏–∂–µ:",
        reply_markup=kb_mode
    )


# =======================
# –í–´–ë–û–† –†–ï–ñ–ò–ú–ê
# =======================
@dp.message_handler(lambda m: m.text in ["‚òï –ö–û–§–ï", "üç∑ –í–ò–ù–û"])
async def choose_mode(message: types.Message):
    game = games.get(message.chat.id)
    if not game:
        await start(message)
        game = games.get(message.chat.id)

    game["mode"] = "wine" if message.text == "üç∑ –í–ò–ù–û" else "coffee"

    await message.answer(
        "–û—Ç–ª–∏—á–Ω–æ! –ù–∞–∂–º–∏ –ì–û–¢–û–í–û, —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å üòÑ",
        reply_markup=kb_ready
    )


# =======================
# –ù–ê–ß–ê–õ–û –ò–ì–†–´
# =======================
@dp.message_handler(lambda m: m.text == "–ì–û–¢–û–í–û")
async def begin(message: types.Message):
    game = games.get(message.chat.id)
    if not game:
        await start(message)
        return

    if not game.get("mode"):
        await message.answer("–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏ —Ä–µ–∂–∏–º: ‚òï –ö–û–§–ï –∏–ª–∏ üç∑ –í–ò–ù–û", reply_markup=kb_mode)
        return

    game["started"] = True
    await send_question(message.chat.id)


async def send_question(chat_id: int):
    game = games.get(chat_id)
    if not game:
        return

    questions = get_questions(game["mode"])

    if game["index"] >= len(questions):
        await bot.send_message(chat_id, get_final_text(game["mode"]), reply_markup=kb_save)
        # –ù–ï —É–¥–∞–ª—è–µ–º games ‚Äî —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞–ª–∏ –∫–Ω–æ–ø–∫–∏ –°–û–•–†–ê–ù–ò–¢–¨ / –ù–ê–ß–ê–¢–¨ –°–ù–û–í–ê
        return

    game["answers"] = []

    await bot.send_message(
        chat_id,
        f"‚ùì {questions[game['index']]['q']}\n\n"
        "–û—Ç–≤–µ—Ç—å—Ç–µ –≤ —á–∞—Ç–µ.\n"
        "–ö–æ–≥–¥–∞ –≤—Å–µ –≥–æ—Ç–æ–≤—ã ‚Äî –Ω–∞–∂–º–∏—Ç–µ ¬´–î–ê–õ–¨–®–ï¬ª",
        reply_markup=kb_next
    )


# =======================
# –°–û–•–†–ê–ù–ò–¢–¨ üíæ (–¢–û–ü-3 –°–ê–ú–´–• –°–ú–ï–®–ù–´–•)
# =======================
@dp.message_handler(lambda m: m.text == "–°–û–•–†–ê–ù–ò–¢–¨ üíæ")
async def save_evening(message: types.Message):
    chat_id = message.chat.id
    game = games.get(chat_id)
    if not game:
        return

    mode_title = "‚òï –ö–û–§–ï" if game.get("mode") == "coffee" else "üç∑ –í–ò–ù–û"
    total_q = game.get("index", 0)
    all_answers = game.get("log", [])

    cleaned = [a.strip() for a in all_answers if a and a.strip() and a.strip() != "–î–ê–õ–¨–®–ï"]

    if cleaned:
        ranked = sorted(cleaned, key=fun_score, reverse=True)

        picks = []
        seen = set()
        for a in ranked:
            k = a.lower()
            if k in seen:
                continue
            seen.add(k)
            picks.append(a)
            if len(picks) == 3:
                break

        picks_text = "\n".join([f"‚Äî {p}" for p in picks])

        memory = (
            f"üíæ –ü–ê–ú–Ø–¢–ö–ê –í–ï–ß–ï–†–ê\n\n"
            f"–†–µ–∂–∏–º: {mode_title}\n"
            f"–í–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ—à–ª–∏: {total_q}\n\n"
            f"–¢–æ–ø-3 —à–µ–¥–µ–≤—Ä–∞ –≤–µ—á–µ—Ä–∞ üòÑ:\n"
            f"{picks_text}\n\n"
            "–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ò–∑–±—Ä–∞–Ω–Ω–æ–µ ‚ú®"
        )
    else:
        memory = (
            f"üíæ –ü–ê–ú–Ø–¢–ö–ê –í–ï–ß–ï–†–ê\n\n"
            f"–†–µ–∂–∏–º: {mode_title}\n"
            f"–í–æ–ø—Ä–æ—Å–æ–≤ –ø—Ä–æ—à–ª–∏: {total_q}\n\n"
            "–°–µ–≥–æ–¥–Ω—è –≤—ã –±—ã–ª–∏ –∑–∞–≥–∞–¥–æ—á–Ω—ã–º–∏ üòÑ\n"
            "–°–æ—Ö—Ä–∞–Ω–∏—Ç–µ —ç—Ç–æ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤ –ò–∑–±—Ä–∞–Ω–Ω–æ–µ ‚ú®"
        )

    await message.answer(memory, reply_markup=kb_save)
    game["started"] = False


# =======================
# –ù–ê–ß–ê–¢–¨ –°–ù–û–í–ê
# =======================
@dp.message_handler(lambda m: m.text == "–ù–ê–ß–ê–¢–¨ –°–ù–û–í–ê")
async def restart(message: types.Message):
    await start(message)


# =======================
# –°–ë–û–† –û–¢–í–ï–¢–û–í + –î–ê–õ–¨–®–ï
# =======================
@dp.message_handler(content_types=types.ContentTypes.TEXT)
async def collect(message: types.Message):
    chat_id = message.chat.id
    game = games.get(chat_id)
    if not game or not game.get("started"):
        return

    text = message.text.strip()

    if text == "–î–ê–õ–¨–®–ï":
        if not game["answers"]:
            await message.answer("–ù—É —Ö–æ—Ç—å —Ç–æ—á–∫—É –∫—Ç–æ-–Ω–∏–±—É–¥—å –ø–æ—Å—Ç–∞–≤—å—Ç–µ üòÑ")
            return

        # —Å–æ—Ö—Ä–∞–Ω—è–µ–º –æ—Ç–≤–µ—Ç—ã —ç—Ç–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞ –≤ –æ–±—â–∏–π –ª–æ–≥
        game["log"].extend(game["answers"])

        chosen = random.choice(game["answers"])

        # –í—ã–±–æ—Ä–æ—á–Ω—ã–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ (35%)
        if random.random() < 0.35:
            comment = random.choice(get_comments(game["mode"]))
            await message.answer(f"üí¨ {chosen}\n\n{comment}")
        else:
            await message.answer(f"üí¨ {chosen}")

        game["index"] += 1
        await send_question(chat_id)
        return

    # –æ–±—ã—á–Ω—ã–π –æ—Ç–≤–µ—Ç —É—á–∞—Å—Ç–Ω–∏—Ü—ã
    game["answers"].append(text)


# =======================
# –ó–ê–ü–£–°–ö
# =======================
if __name__ == "__main__":
    executor.start_polling(dp, skip_updates=True)
